페이지네이션(Pagination)은 많은 양의 데이터를 한 번에 모두 보여주지 않고, 여러 페이지로 나누어 보여주는 방식이다.

리퀘스트로 데이터를 한번에 받아오는 것이 아니라 일부만 받아와야 하기 때문에,

1) 받아올 개수 (=limit)
2) 어디까지 받았는지 (어디서부터 받을 건지)

가 필요한데,

두가지 방식이 존재한다.

1. 오프셋(Offset) 기반
2. 커서(Cursor) 기반


![[페이지네이션.png]]

### 1. 오프셋 기반

	/...?offset=20&limit=10

지금까지 20개 데이터를 받았고 10개 보내줘
-> 리퀘스트 도중에 앞 부분(이미 받은 부분) 자료가 추가되거나 삭제되면, 중복/누락의 문제가 생길 수 있다.

![[페이지네이션offset.png]]

### 2. 커서 기반

	/...?cursor=WerZxc&limit=10
	

마지막 받은 위치의 책갈피는 여기고 이후 10개를 줘
-> 마지막 위치를 커서로 표시하기 때문에 앞 부분에 수정이 생겨도 뒷부분을 정상적으로 받아올 수 있다.

**현재 주로 사용하는 것은 커서 기반 페이지네이션이다.**

### 페이지네이션은 서버가 리퀘스트/리스폰스를 지원해줘야 쓸 수 있다.

서버에서 리스폰스 결과로 주는 json파일에
```bash
{
	"food": {},
	"paging": {
		"cursor": wdasdfgwg,
		""
	}
}
```
이런 식으로 마지막 커서를 알려주고,
```JSX
const query = `order=${order}&cursor=${cursor}&limit=${limit}`;
const response = await fetch(`https://learn.codeit.kr/api/foods?${query}`);
```
cursor, limit 등의 쿼리를 리퀘스트로 받을 수 있는 처리가 되어 있어야 한다.

#### 리액트 활용

```JSX
import { useEffect, useState } from 'react';
import { getFoods } from '../api';
import FoodList from './FoodList';

function App() {
  const [order, setOrder] = useState('createdAt');
  const [items, setItems] = useState([]);
  const [cursor, setCursor] = useState();

  const handleNewestClick = () => setOrder('createdAt');

  const handleCalorieClick = () => setOrder('calorie');

  const handleDelete = (id) => {
    const nextItems = items.filter((item) => item.id !== id);
    setItems(nextItems);
  };
  
  const handleLoad = async (options) => {
    const { foods, paging: {nextCursor}, } = await getFoods(options);
    if(!options.cursor){
      setItems(foods);
    } else{
      setItems((prevItems) => [...prevItems, ...foods]);
    }
    setCursor(nextCursor);
  };

  const handleLoadMore = async () => {
    handleLoad({
      order,
      cursor,
    });
  };

  const sortedItems = items.sort((a, b) => b[order] - a[order]);

  useEffect(() => {
    handleLoad({order, });
  }, [order]);

  return (
    <div>
      <button onClick={handleNewestClick}>최신순</button>
      <button onClick={handleCalorieClick}>칼로리순</button>
      <FoodList items={sortedItems} onDelete={handleDelete} />
      {cursor && <button onClick={handleLoadMore}>더보기</button>}
    </div>
  );
}

export default App;
```

```JSX
export async function getFoods({ order = '', cursor = '', limit = 10 }) {
  const query = `order=${order}&cursor=${cursor}&limit=${limit}`;
  const response = await fetch(`https://learn.codeit.kr/api/foods?${query}`);
  const body = await response.json();
  return body;
}
```

리스폰스 결과에 paging이 포함 되어 있어서 거기서 마지막 cursor 값을 받아온다.
리퀘스트 함수에 cursor와 limit을 추가해주고,
handleLoad() 함수도 opsions로 프로퍼티를 여러 개 받을 수 있도록 바꿔 준다.
cursor를 useState로 관리해준다.

처음 실행 시에는 커서 값이 없으므로 그냥 받아오고,
더보기 버튼을 누르면 마지막 커서를 기준으로 배열에 추가 된다.